app-id: com.lbjlaq.antigravity-tools
runtime: org.gnome.Platform
runtime-version: '46'
sdk: org.gnome.Sdk
command: antigravity-tools
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --share=network
modules:
  - name: antigravity-tools
    buildsystem: simple
    build-commands:
      # Copy the contents of the 'usr' directory from the unpacked Deb to /app
      - cp -r usr/* /app/
      # Rename binary to match command (Tauri uses underscore, we want dash)
      - mv /app/bin/antigravity_tools /app/bin/antigravity-tools
      
      # Fix Desktop File and Icons for Flatpak Export compliance
      # 1. Update Exec command in the original desktop file
      - find /app/share/applications -name "*.desktop" -exec sed -i 's/Exec=antigravity_tools/Exec=antigravity-tools/g' {} +
      
      # 2. Rename desktop file to match App ID (Required for export)
      - mv "/app/share/applications/Antigravity Tools.desktop" /app/share/applications/com.lbjlaq.antigravity-tools.desktop
      
      # 3. Rename icons to match App ID (Required for export)
      # Find all antigravity_tools.png and rename to com.lbjlaq.antigravity-tools.png
      - find /app/share/icons -name "antigravity_tools.png" -exec sh -c 'mv "$1" "$(dirname "$1")/com.lbjlaq.antigravity-tools.png"' _ {} \;
      # Also handling if they are named icon.png (tauri defaults sometimes)
      - find /app/share/icons -name "icon.png" -exec sh -c 'mv "$1" "$(dirname "$1")/com.lbjlaq.antigravity-tools.png"' _ {} \;
      
      # 4. Update Icon reference in the desktop file
      - sed -i 's/Icon=antigravity_tools/Icon=com.lbjlaq.antigravity-tools/g' /app/share/applications/com.lbjlaq.antigravity-tools.desktop

    sources:
      # This path is relative to where flatpak-builder is run. 
      # The workflow will unpack the deb into 'flatpak-build-source'
      - type: dir
        path: flatpak-build-source
